<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Files | متجر الملفات الرقمية الفاخر</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- Firebase Initialization Script -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCuP6VscPxkQS5D5z7bCYWXijzaYCdbF2s",
            authDomain: "starkoscript.firebaseapp.com",
            databaseURL: "https://starkoscript-default-rtdb.firebaseio.com",
            projectId: "starkoscript",
            storageBucket: "starkoscript.appspot.com",
            messagingSenderId: "381525854892",
            appId: "1:381525854892:android:50ba5daa1cffae8faa2d09"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
    </script>
    
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        :root {
            --gold: #FFD700;
            --dark-gold: #D4AF37;
            --black: #0A0A0A;
            --gray: #1A1A1A;
            --light-gray: #2A2A2A;
            --white: #FFFFFF;
            --red: #E74C3C;
            --green: #27AE60;
            --blue: #3498DB;
            --purple: #9B59B6;
            --orange: #F39C12;
        }
        
        body {
            background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header */
        .main-header {
            background: linear-gradient(90deg, var(--black) 0%, var(--gray) 100%);
            padding: 25px 0;
            border-bottom: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }
        
        .logo i {
            color: var(--gold);
            font-size: 2.8rem;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3));
        }
        
        .logo h1 {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(to right, var(--gold), var(--dark-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
        }
        
        .logo span {
            color: var(--white);
            font-weight: 300;
        }
        
        .user-badge {
            background: linear-gradient(45deg, var(--blue), #2980b9);
            color: var(--white);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        .admin-badge {
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            color: var(--black);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .admin-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Sections */
        .section {
            margin-bottom: 60px;
            padding: 40px;
            background: rgba(20, 20, 20, 0.9);
            border-radius: 25px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }
        
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--gold), var(--dark-gold));
        }
        
        .section-title {
            font-size: 2.2rem;
            margin-bottom: 40px;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 20px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .section-title i {
            font-size: 2.5rem;
        }
        
        /* Files Grid */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 40px;
            margin-bottom: 50px;
        }
        
        .file-card {
            background: linear-gradient(145deg, #1A1A1A, #121212);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 215, 0, 0.15);
            position: relative;
        }
        
        .file-card:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6), 0 0 0 2px rgba(255, 215, 0, 0.2);
        }
        
        .file-header {
            padding: 30px 25px;
            background: linear-gradient(135deg, var(--black), var(--gray));
            text-align: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.25);
            position: relative;
            overflow: hidden;
        }
        
        .file-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--gold);
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.4));
            position: relative;
            z-index: 1;
        }
        
        .file-name {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--white);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .file-price {
            font-size: 2rem;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            position: relative;
            z-index: 1;
        }
        
        .free-badge {
            font-size: 2rem;
            font-weight: 900;
            color: var(--green);
            text-shadow: 0 0 15px rgba(39, 174, 96, 0.4);
            position: relative;
            z-index: 1;
        }
        
        .file-body {
            padding: 30px 25px;
            position: relative;
            z-index: 1;
        }
        
        .file-description {
            color: #DDDDDD;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 30px;
            min-height: 130px;
        }
        
        .file-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .file-detail {
            text-align: center;
            flex: 1;
        }
        
        .file-detail i {
            color: var(--gold);
            font-size: 1.4rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .file-detail span {
            font-size: 0.95rem;
            color: #BBBBBB;
        }
        
        .file-actions {
            display: flex;
            gap: 12px;
        }
        
        .buy-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            color: var(--black);
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            box-shadow: 0 7px 20px rgba(255, 215, 0, 0.25);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .buy-btn:hover {
            background: linear-gradient(45deg, var(--dark-gold), var(--gold));
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.35);
        }
        
        .download-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(45deg, var(--green), #2ECC71);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            box-shadow: 0 7px 20px rgba(39, 174, 96, 0.25);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .download-btn:hover {
            background: linear-gradient(45deg, #2ECC71, var(--green));
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.35);
        }
        
        .download-free-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, var(--green), #2ECC71);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            box-shadow: 0 7px 20px rgba(39, 174, 96, 0.25);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .download-free-btn:hover {
            background: linear-gradient(45deg, #2ECC71, var(--green));
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.35);
        }
        
        /* Admin Panel */
        .admin-panel {
            background: rgba(15, 15, 15, 0.95);
            border: 2px solid var(--gold);
            border-radius: 25px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        }
        
        .admin-title {
            color: var(--gold);
            font-size: 2rem;
            margin-bottom: 35px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .admin-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 12px;
            color: var(--gold);
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-control {
            padding: 18px;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 215, 0, 0.25);
            border-radius: 12px;
            color: var(--white);
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.15);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: var(--gold);
            cursor: pointer;
        }
        
        .file-upload-area {
            border: 3px dashed rgba(255, 215, 0, 0.35);
            border-radius: 15px;
            padding: 50px 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
            background: rgba(255, 215, 0, 0.03);
        }
        
        .file-upload-area:hover {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.07);
            transform: translateY(-2px);
        }
        
        .file-upload-area i {
            font-size: 4rem;
            color: var(--gold);
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3));
        }
        
        .submit-btn {
            grid-column: 1 / -1;
            padding: 20px;
            background: linear-gradient(45deg, var(--green), #2ECC71);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.4rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }
        
        .submit-btn:hover {
            background: linear-gradient(45deg, #2ECC71, var(--green));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(39, 174, 96, 0.4);
        }
        
        /* Payment Section */
        .payment-section {
            background: rgba(15, 15, 15, 0.95);
            border-radius: 25px;
            padding: 40px;
            margin-top: 40px;
            border: 2px solid rgba(52, 152, 219, 0.35);
            display: none;
        }
        
        .payment-title {
            color: var(--blue);
            font-size: 2rem;
            margin-bottom: 35px;
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.2);
        }
        
        .payment-steps {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .payment-step {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border-right: 5px solid var(--blue);
            transition: all 0.3s;
        }
        
        .payment-step:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-3px);
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--blue);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-weight: 900;
            margin-left: 15px;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .payment-info {
            background: rgba(255, 215, 0, 0.12);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 25px 0;
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .phone-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--gold);
            direction: ltr;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            margin: 20px 0;
            letter-spacing: 2px;
        }
        
        .upload-area {
            border: 3px dashed rgba(255, 215, 0, 0.35);
            border-radius: 15px;
            padding: 50px 25px;
            text-align: center;
            margin: 30px 0;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 215, 0, 0.03);
        }
        
        .upload-area:hover {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.07);
            transform: translateY(-2px);
        }
        
        .upload-area i {
            font-size: 4rem;
            color: var(--gold);
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3));
        }
        
        .payment-options {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .whatsapp-btn {
            flex: 1;
            min-width: 200px;
            padding: 16px 30px;
            background: linear-gradient(45deg, #25D366, #128C7E);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 7px 20px rgba(37, 211, 102, 0.25);
        }
        
        .whatsapp-btn:hover {
            background: linear-gradient(45deg, #128C7E, #25D366);
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 12px 25px rgba(37, 211, 102, 0.35);
        }
        
        /* Orders Section */
        .orders-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .order-card {
            background: rgba(26, 26, 26, 0.8);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .order-file {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--gold);
        }
        
        .order-status {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 800;
            font-size: 0.95rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .status-pending {
            background: linear-gradient(45deg, rgba(231, 76, 60, 0.2), rgba(192, 57, 43, 0.2));
            color: var(--red);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .status-completed {
            background: linear-gradient(45deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.2));
            color: var(--green);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        
        .order-details {
            margin-bottom: 25px;
        }
        
        .order-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.07);
        }
        
        .order-detail:last-child {
            border-bottom: none;
        }
        
        .order-proof {
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        
        .order-proof img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            object-fit: contain;
            background: #000;
        }
        
        .order-proof img:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .proof-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .confirm-btn {
            flex: 1;
            min-width: 150px;
            padding: 14px;
            background: linear-gradient(45deg, var(--green), #2ECC71);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .confirm-btn:hover {
            background: linear-gradient(45deg, #2ECC71, var(--green));
            transform: translateY(-2px);
        }
        
        .reject-btn {
            flex: 1;
            min-width: 150px;
            padding: 14px;
            background: linear-gradient(45deg, var(--red), #C0392B);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .reject-btn:hover {
            background: linear-gradient(45deg, #C0392B, var(--red));
            transform: translateY(-2px);
        }
        
        .delete-proof-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, var(--orange), #E67E22);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }
        
        .delete-proof-btn:hover {
            background: linear-gradient(45deg, #E67E22, var(--orange));
            transform: translateY(-2px);
        }
        
        /* Login Section */
        .login-section {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 25px;
            padding: 50px;
            text-align: center;
            border: 3px solid var(--gold);
            max-width: 500px;
            margin: 60px auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .login-title {
            color: var(--gold);
            font-size: 2.8rem;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .login-input {
            width: 100%;
            padding: 22px;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 215, 0, 0.25);
            border-radius: 15px;
            color: var(--white);
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
        }
        
        .login-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.15);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 22px;
            background: linear-gradient(45deg, var(--gold), var(--dark-gold));
            color: var(--black);
            border: none;
            border-radius: 15px;
            font-size: 1.4rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
        }
        
        .login-btn:hover {
            background: linear-gradient(45deg, var(--dark-gold), var(--gold));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 30px rgba(255, 215, 0, 0.4);
        }
        
        /* Admin Login Modal */
        .admin-login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .admin-login-content {
            background: rgba(20, 20, 20, 0.98);
            border-radius: 25px;
            padding: 50px;
            max-width: 500px;
            width: 100%;
            border: 3px solid var(--gold);
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.2);
            position: relative;
            animation: modalSlide 0.4s ease-out;
        }
        
        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--gold);
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        /* File Management */
        .file-management {
            margin-top: 40px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.15);
            transition: all 0.3s;
        }
        
        .file-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .file-item-info {
            flex: 1;
        }
        
        .file-item-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 8px;
        }
        
        .file-item-details {
            color: #AAAAAA;
            font-size: 0.95rem;
        }
        
        .file-actions-admin {
            display: flex;
            gap: 12px;
        }
        
        .edit-btn, .delete-btn, .toggle-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background: linear-gradient(45deg, var(--blue), #2980b9);
            color: white;
        }
        
        .edit-btn:hover {
            background: linear-gradient(45deg, #2980b9, var(--blue));
            transform: translateY(-2px);
        }
        
        .delete-btn {
            background: linear-gradient(45deg, var(--red), #C0392B);
            color: white;
        }
        
        .delete-btn:hover {
            background: linear-gradient(45deg, #C0392B, var(--red));
            transform: translateY(-2px);
        }
        
        .toggle-btn {
            background: linear-gradient(45deg, var(--purple), #8E44AD);
            color: white;
        }
        
        .toggle-btn:hover {
            background: linear-gradient(45deg, #8E44AD, var(--purple));
            transform: translateY(-2px);
        }
        
        /* Footer */
        .main-footer {
            background: var(--black);
            padding: 50px 0;
            margin-top: 80px;
            border-top: 3px solid var(--gold);
            text-align: center;
            position: relative;
        }
        
        .main-footer::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--dark-gold), var(--gold));
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .copyright {
            color: #AAAAAA;
            font-size: 1.1rem;
            margin-top: 25px;
        }
        
        .copyright i {
            color: var(--red);
            margin: 0 5px;
        }
        
        /* Hidden class */
        .hidden {
            display: none;
        }
        
        /* Back Navigation */
        .back-nav {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .back-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #7f8c8d, #95a5a6);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(127, 140, 141, 0.2);
        }
        
        .back-btn:hover {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(127, 140, 141, 0.3);
        }
        
        /* Security Features */
        .security-features {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }
        
        .security-badge {
            background: rgba(0, 0, 0, 0.8);
            padding: 12px 20px;
            border-radius: 30px;
            border: 1px solid var(--gold);
            font-size: 0.9rem;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            width: 0%;
            height: 8px;
            background: linear-gradient(90deg, var(--green), #2ECC71);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--green);
            color: white;
            padding: 18px 35px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            font-weight: 800;
            display: none;
            animation: slideIn 0.3s ease-out;
            text-align: center;
            min-width: 300px;
            max-width: 90%;
        }
        
        .notification.error {
            background: var(--red);
        }
        
        .notification.info {
            background: var(--blue);
        }
        
        .notification.warning {
            background: var(--orange);
        }
        
        @keyframes slideIn {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .files-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 30px;
            }
            
            .orders-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 25px;
                text-align: center;
            }
            
            .files-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-form {
                grid-template-columns: 1fr;
            }
            
            .orders-container {
                grid-template-columns: 1fr;
            }
            
            .phone-number {
                font-size: 2rem;
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .file-actions-admin {
                width: 100%;
                justify-content: flex-end;
            }
            
            .section {
                padding: 30px 20px;
            }
        }
        
        @media (max-width: 480px) {
            .login-section {
                padding: 30px 20px;
                margin: 30px 20px;
            }
            
            .admin-login-content {
                padding: 30px 20px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .phone-number {
                font-size: 1.6rem;
            }
        }
    </style>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <!-- Admin Login Modal -->
    <div class="admin-login-modal" id="adminLoginModal">
        <div class="admin-login-content">
            <button class="close-modal" id="closeLoginModal">&times;</button>
            <h2 style="color: var(--gold); text-align: center; margin-bottom: 40px;">
                <i class="fas fa-lock"></i> دخول المسؤول
            </h2>
            <div class="form-group">
                <label for="adminPassword"><i class="fas fa-key"></i> كلمة مرور المسؤول</label>
                <input type="password" id="adminPassword" class="form-control" 
                       placeholder="أدخل كلمة مرور المسؤول" autocomplete="off">
            </div>
            <button id="loginAdminBtn" class="submit-btn" style="margin-top: 30px;">
                <i class="fas fa-sign-in-alt"></i> دخول المسؤول
            </button>
            <p style="text-align: center; margin-top: 30px; color: #AAAAAA; font-size: 0.95rem;">
                هذا القسم مخصص للمسؤول فقط
            </p>
        </div>
    </div>

    <!-- Login Section (Shown by default) -->
    <section class="login-section" id="loginSection">
        <div class="logo" style="justify-content: center; margin-bottom: 40px;">
            <i class="fas fa-crown"></i>
            <h1>Elite<span>Files</span></h1>
        </div>
        <h2 class="login-title">
            <i class="fas fa-sign-in-alt"></i>
            تسجيل الدخول
        </h2>
        <p style="color: #DDDDDD; margin-bottom: 40px; font-size: 1.2rem; line-height: 1.6;">
            مرحباً بك في Elite Files، متجر الملفات الرقمية الفاخر
            <br>أدخل اسم المستخدم للدخول إلى المتجر
        </p>
        <input type="text" id="usernameInput" class="login-input" 
               placeholder="أدخل اسم المستخدم" autocomplete="off" autofocus>
        <button id="loginBtn" class="login-btn">
            <i class="fas fa-sign-in-alt"></i> دخول إلى المتجر
        </button>
        <p style="color: #AAAAAA; margin-top: 30px; font-size: 0.95rem;">
            للمستخدمين العاديين فقط - لا توجد كلمات مرور
        </p>
    </section>
    
    <!-- Main Content (Hidden by default until login) -->
    <div id="mainContent" class="hidden">
        <!-- Header -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo" onclick="goBackToFiles()">
                    <i class="fas fa-crown"></i>
                    <h1>Elite<span>Files</span></h1>
                </div>
                <div id="userInfo">
                    <!-- سيتم تعبئته بالجافاسكريبت -->
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="container">
            <!-- Files Section -->
            <section class="section" id="filesSection">
                <h2 class="section-title">
                    <i class="fas fa-gem"></i>
                    ملفاتنا المميزة
                </h2>
                <div class="files-grid" id="filesContainer">
                    <!-- سيتم تعبئته من Firebase -->
                    <p style="text-align: center; color: #AAAAAA; grid-column: 1 / -1; padding: 40px;" id="noFilesMessage">
                        <i class="fas fa-folder-open" style="font-size: 4rem; margin-bottom: 20px; display: block;"></i>
                        لا توجد ملفات متاحة حالياً
                    </p>
                </div>
                
                <!-- Back Navigation -->
                <div class="back-nav">
                    <button class="back-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                    </button>
                </div>
            </section>

            <!-- Admin Panel (Shown only for Admin with password) -->
            <section class="section admin-panel hidden" id="adminPanel">
                <h2 class="admin-title">
                    <i class="fas fa-user-cog"></i>
                    لوحة تحكم المسؤول
                </h2>
                
                <!-- إدارة الملفات الحالية -->
                <div class="file-management">
                    <h3 class="section-title" style="font-size: 1.6rem; margin-bottom: 25px;">
                        <i class="fas fa-folder-open"></i>
                        إدارة الملفات الحالية
                    </h3>
                    <div id="currentFilesList">
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </div>
                </div>
                
                <!-- إضافة ملف جديد -->
                <h3 class="section-title" style="font-size: 1.6rem; margin-top: 50px;">
                    <i class="fas fa-plus-circle"></i>
                    إضافة ملف جديد
                </h3>
                <form class="admin-form" id="fileForm">
                    <div class="form-group">
                        <label for="fileName"><i class="fas fa-file-alt"></i> اسم الملف</label>
                        <input type="text" id="fileName" class="form-control" placeholder="أدخل اسم الملف" required>
                    </div>
                    <div class="form-group">
                        <label for="fileDescription"><i class="fas fa-align-left"></i> وصف الملف</label>
                        <textarea id="fileDescription" class="form-control" rows="3" 
                                  placeholder="أدخل وصف للملف" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="filePrice"><i class="fas fa-tag"></i> السعر (جنية)</label>
                        <input type="number" id="filePrice" class="form-control" 
                               placeholder="أدخل السعر (0 للمجاني)" min="0" value="0" required>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="isPaid">
                        <label for="isPaid" style="color: var(--gold); font-weight: 700; cursor: pointer;">
                            ملف مدفوع
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="fileUpload"><i class="fas fa-cloud-upload-alt"></i> رفع الملف</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>انقر لرفع الملف الحقيقي</p>
                            <p id="fileNameDisplay" style="color: var(--gold); margin-top: 15px; font-weight: 700; font-size: 1.1rem;"></p>
                            <p style="color: #AAAAAA; font-size: 0.9rem; margin-top: 10px;">الحد الأقصى: 50MB</p>
                        </div>
                        <input type="file" id="fileUpload" style="display: none;">
                    </div>
                    <div class="progress-container" id="uploadProgress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <button type="submit" class="submit-btn" id="submitFileBtn">
                        <i class="fas fa-cloud-upload-alt"></i> رفع الملف
                    </button>
                </form>
                
                <!-- إدارة الطلبات -->
                <div id="ordersManagement" style="margin-top: 50px;">
                    <h3 class="section-title" style="font-size: 1.6rem;">
                        <i class="fas fa-clipboard-list"></i>
                        إدارة الطلبات
                    </h3>
                    <div class="orders-container" id="ordersContainer">
                        <!-- سيتم تعبئته من Firebase -->
                    </div>
                </div>
                
                <!-- Back Navigation -->
                <div class="back-nav">
                    <button class="back-btn" onclick="goBackToFiles()">
                        <i class="fas fa-arrow-right"></i> العودة للملفات
                    </button>
                </div>
            </section>

            <!-- Payment Section (Hidden by default) -->
            <section class="payment-section" id="paymentSection">
                <h2 class="payment-title">
                    <i class="fas fa-shopping-cart"></i>
                    إتمام عملية الشراء
                </h2>
                
                <div class="payment-steps">
                    <div class="payment-step">
                        <span class="step-number">1</span>
                        <h3>دفع المبلغ</h3>
                        <p style="color: #DDDDDD; line-height: 1.7; margin-top: 15px;">
                            قم بتحويل المبلغ إلى الرقم التالي عبر فودافون كاش أو أي محفظة رقمية
                        </p>
                        <div class="payment-info">
                            <p style="font-size: 1.2rem; color: var(--gold);">
                                <i class="fas fa-phone"></i> رقم الدفع:
                            </p>
                            <div class="phone-number">01013091169</div>
                            <p style="font-size: 1.4rem; margin: 10px 0;">
                                المبلغ: <span id="paymentAmount" style="color: var(--gold); font-weight: 900;">0</span> ج.م
                            </p>
                            <p style="font-size: 1.2rem; color: #DDDDDD;">
                                الملف: <span id="paymentFileName" style="color: var(--gold); font-weight: 700;">غير محدد</span>
                            </p>
                        </div>
                        <div class="payment-options">
                            <button id="uploadProofBtn" class="buy-btn" style="flex: 2;">
                                <i class="fas fa-cloud-upload-alt"></i> رفع إثبات الدفع
                            </button>
                            <button id="whatsappProofBtn" class="whatsapp-btn">
                                <i class="fab fa-whatsapp"></i> إرسال على واتساب
                            </button>
                        </div>
                    </div>
                    
                    <div class="payment-step" id="proofStep">
                        <span class="step-number">2</span>
                        <h3>رفع إثبات الدفع</h3>
                        <p style="color: #DDDDDD; line-height: 1.7; margin-top: 15px;">
                            قم برفع صورة إثبات الدفع (سكرين شوت) في المكان المخصص أدناه
                        </p>
                        <div class="upload-area hidden" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>انقر لرفع صورة إثبات الدفع</p>
                            <p id="proofFileName" style="color: var(--gold); margin-top: 15px; font-weight: 700; font-size: 1.1rem;"></p>
                            <p style="color: #AAAAAA; font-size: 0.9rem; margin-top: 10px;">يسمح بصيغ: JPG, PNG, GIF - أقصى حجم: 5MB</p>
                        </div>
                        <input type="file" id="paymentProof" accept="image/*" style="display: none;">
                        <div id="previewContainer" class="hidden">
                            <img id="previewImage" src="#" alt="إثبات الدفع" 
                                 style="max-width: 100%; border-radius: 12px; margin: 25px auto; display: block; border: 3px solid rgba(255, 215, 0, 0.3);">
                        </div>
                    </div>
                    
                    <div class="payment-step">
                        <span class="step-number">3</span>
                        <h3>تأكيد الطلب</h3>
                        <p style="color: #DDDDDD; line-height: 1.7; margin-top: 15px;">
                            بعد رفع إثبات الدفع، سيتم مراجعة طلبك وتأكيده من قبل المسؤول، 
                            ثم سيتم إتاحة تحميل الملف لك مباشرة من صفحة الملفات.
                        </p>
                        <button id="submitPayment" class="buy-btn" style="margin-top: 25px;">
                            <i class="fas fa-paper-plane"></i> إرسال الطلب للمسؤول
                        </button>
                    </div>
                </div>
                
                <!-- Back Navigation -->
                <div class="back-nav">
                    <button class="back-btn" onclick="goBackToFiles()">
                        <i class="fas fa-arrow-right"></i> العودة للملفات
                    </button>
                </div>
            </section>
        </div>

        <!-- Security Features -->
        <div class="security-features">
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                <span>نظام آمن</span>
            </div>
            <div class="security-badge">
                <i class="fas fa-lock"></i>
                <span>تشفير متقدم</span>
            </div>
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="logo" style="justify-content: center;">
                    <i class="fas fa-crown"></i>
                    <h1>Elite<span>Files</span></h1>
                </div>
                <p class="copyright">
                    جميع الحقوق محفوظة &copy; 2024 - تم التطوير بواسطة <i class="fas fa-heart"></i> Mahmoud Gamal
                </p>
            </div>
        </footer>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Main JavaScript -->
    <script>
        // ============================================
        // Elite Files - النسخة النهائية المظبوطة
        // ============================================
        
        // بيانات الجلسة
        let currentUser = null;
        let isAdmin = false;
        let selectedFileForPurchase = null;
        let uploadedFile = null;
        let proofFile = null;
        let editingFileId = null;
        let userFiles = {}; // تخزين الملفات التي تم شراؤها من قبل المستخدم
        let deviceId = null; // معرف الجهاز الفريد
        
        // إعدادات النظام
        const ADMIN_USERNAME = "M7mø7dd"; // اسم المسؤول المخفي
        const ADMIN_PASSWORD = "admin123"; // كلمة مرور المسؤول
        const VODAFONE_NUMBER = "01013091169"; // رقم فودافون كاش
        
        // متغيرات Firebase
        let filesRef, ordersRef, purchasedRef, usersRef;
        
        // ============================================
        // تهيئة التطبيق
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // إعداد مراجع Firebase
            filesRef = database.ref('files');
            ordersRef = database.ref('orders');
            purchasedRef = database.ref('purchased');
            usersRef = database.ref('users'); // مرجع جديد لمستخدمي الجهاز
            
            // إنشاء أو الحصول على معرف الجهاز الفريد
            generateDeviceId();
            
            // إعداد معالجات الأحداث
            setupEventListeners();
            
            // محاولة تحميل حالة المستخدم من التخزين المحلي
            loadUserSession();
        });
        
        // إنشاء معرف جهاز فريد
        function generateDeviceId() {
            let deviceId = localStorage.getItem('eliteFilesDeviceId');
            
            if (!deviceId) {
                // إنشاء معرف فريد للجهاز
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('eliteFilesDeviceId', deviceId);
            }
            
            return deviceId;
        }
        
        // ============================================
        // نظام تسجيل الدخول المحسن - اسم مستخدم واحد للجهاز
        // ============================================
        
        // تحميل حالة المستخدم من localStorage
        function loadUserSession() {
            const savedUser = localStorage.getItem('eliteFilesUser');
            const savedAdmin = localStorage.getItem('eliteFilesAdmin');
            const savedAdminPassword = localStorage.getItem('eliteFilesAdminPassword');
            const savedDeviceId = localStorage.getItem('eliteFilesDeviceId');
            
            if (savedUser && savedDeviceId === deviceId) {
                currentUser = savedUser;
                
                // التحقق إذا كان مسؤولاً
                if (savedAdmin === 'true' && savedAdminPassword === ADMIN_PASSWORD) {
                    isAdmin = true;
                    currentUser = ADMIN_USERNAME;
                    showMainContent();
                } else if (savedUser !== ADMIN_USERNAME) {
                    // مستخدم عادي - التحقق من الجهاز والاسم
                    checkUserDevice(savedUser);
                }
            }
        }
        
        // التحقق من جهاز المستخدم
        async function checkUserDevice(username) {
            try {
                const userSnapshot = await usersRef.child(username).once('value');
                const userData = userSnapshot.val();
                
                if (userData && userData.deviceId === deviceId) {
                    // نفس الجهاز المسجل
                    isAdmin = false;
                    currentUser = username;
                    showMainContent();
                    loadUserPurchasedFiles();
                } else {
                    // اسم مستخدم موجود على جهاز آخر - نطلب اسم جديد
                    showNotification('⚠️ هذا الاسم مستخدم بالفعل على جهاز آخر. اختر اسم آخر.', 'warning');
                    localStorage.removeItem('eliteFilesUser');
                    localStorage.removeItem('eliteFilesAdmin');
                    localStorage.removeItem('eliteFilesAdminPassword');
                    document.getElementById('usernameInput').value = '';
                    document.getElementById('usernameInput').focus();
                }
            } catch (error) {
                console.error('خطأ في التحقق من المستخدم:', error);
            }
        }
        
        // حفظ جلسة المستخدم في localStorage
        function saveUserSession() {
            if (currentUser === ADMIN_USERNAME && isAdmin) {
                localStorage.setItem('eliteFilesUser', currentUser);
                localStorage.setItem('eliteFilesAdmin', 'true');
                localStorage.setItem('eliteFilesAdminPassword', ADMIN_PASSWORD);
                localStorage.setItem('eliteFilesDeviceId', deviceId);
            } else if (currentUser !== ADMIN_USERNAME) {
                localStorage.setItem('eliteFilesUser', currentUser);
                localStorage.setItem('eliteFilesAdmin', 'false');
                localStorage.setItem('eliteFilesDeviceId', deviceId);
                localStorage.removeItem('eliteFilesAdminPassword');
            }
        }
        
        // تسجيل الدخول
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const username = document.getElementById('usernameInput').value.trim();
            
            if (!username) {
                showNotification('يرجى إدخال اسم المستخدم', 'error');
                return;
            }
            
            // التحقق من اسم المسؤول
            if (username === ADMIN_USERNAME) {
                showAdminLogin();
                return;
            }
            
            // التحقق من المستخدم العادي
            await loginAsUser(username);
        });
        
        // تسجيل دخول كمستخدم عادي
        async function loginAsUser(username) {
            showLoading(true);
            
            try {
                // التحقق إذا كان المستخدم موجوداً على جهاز آخر
                const userSnapshot = await usersRef.child(username).once('value');
                const userData = userSnapshot.val();
                
                if (userData) {
                    // مستخدم موجود - التحقق من الجهاز
                    if (userData.deviceId && userData.deviceId !== deviceId) {
                        showLoading(false);
                        showNotification('⚠️ هذا الاسم مستخدم بالفعل على جهاز آخر. اختر اسم جديد.', 'error');
                        document.getElementById('usernameInput').value = '';
                        document.getElementById('usernameInput').focus();
                        return;
                    }
                    
                    // تحديث آخر تسجيل دخول
                    await usersRef.child(username).update({
                        lastLogin: Date.now()
                    });
                } else {
                    // مستخدم جديد - تسجيله بالجهاز الحالي
                    await usersRef.child(username).set({
                        deviceId: deviceId,
                        createdAt: Date.now(),
                        lastLogin: Date.now()
                    });
                }
                
                isAdmin = false;
                currentUser = username;
                
                // حفظ الجلسة في localStorage
                saveUserSession();
                
                // تحميل الملفات المشتراة للمستخدم
                loadUserPurchasedFiles();
                
                // عرض المحتوى الرئيسي
                showMainContent();
                
                showNotification(`مرحباً بك ${username}! 👋`, 'success');
                
            } catch (error) {
                showNotification('حدث خطأ أثناء تسجيل الدخول', 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // عرض نافذة دخول المسؤول
        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'flex';
            document.getElementById('adminPassword').focus();
        }
        
        // إغلاق نافذة دخول المسؤول
        document.getElementById('closeLoginModal').addEventListener('click', function() {
            document.getElementById('adminLoginModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        });
        
        // محاولة دخول المسؤول
        document.getElementById('loginAdminBtn').addEventListener('click', function() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                showLoading(true);
                
                setTimeout(() => {
                    // دخول كمسؤول
                    isAdmin = true;
                    currentUser = ADMIN_USERNAME;
                    
                    // حفظ الجلسة في localStorage
                    saveUserSession();
                    
                    // إغلاق النافذة وعرض المحتوى
                    document.getElementById('adminLoginModal').style.display = 'none';
                    document.getElementById('adminPassword').value = '';
                    
                    // تحميل البيانات
                    loadFilesFromFirebase();
                    loadCurrentFilesForAdmin();
                    loadOrdersFromFirebase();
                    
                    showMainContent();
                    showLoading(false);
                    showNotification('مرحباً بالمسؤول! 🎯', 'success');
                }, 800);
            } else {
                showNotification('كلمة المرور غير صحيحة! ⚠️', 'error');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        });
        
        // ============================================
        // عرض المحتوى الرئيسي
        // ============================================
        
        function showMainContent() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            
            // تحديث شريط المستخدم
            updateUserBar();
            
            // تحميل الملفات
            loadFilesFromFirebase();
            
            // إذا كان مسؤولاً، عرض لوحة التحكم
            if (isAdmin) {
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('filesSection').classList.add('hidden');
            } else {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('filesSection').classList.remove('hidden');
            }
            
            // إخفاء الأقسام الأخرى
            document.getElementById('paymentSection').style.display = 'none';
        }
        
        // تحديث شريط المعلومات
        function updateUserBar() {
            const userInfo = document.getElementById('userInfo');
            
            if (isAdmin) {
                userInfo.className = 'admin-badge';
                userInfo.innerHTML = `<i class="fas fa-user-shield"></i> ${currentUser} <span style="font-size: 0.85rem; opacity: 0.9;">(مسؤول)</span>`;
                userInfo.title = 'أنت مسؤول النظام';
                userInfo.onclick = function() {
                    if (confirm('هل تريد تسجيل الخروج؟')) {
                        logout();
                    }
                };
            } else {
                userInfo.className = 'user-badge';
                userInfo.innerHTML = `<i class="fas fa-user"></i> ${currentUser}`;
                userInfo.title = 'مستخدم عادي';
                userInfo.onclick = function() {
                    if (confirm('هل تريد تسجيل الخروج؟')) {
                        logout();
                    }
                };
            }
        }
        
        // تسجيل الخروج
        function logout() {
            showLoading(true);
            
            setTimeout(() => {
                // مسح بيانات الجلسة
                localStorage.removeItem('eliteFilesUser');
                localStorage.removeItem('eliteFilesAdmin');
                localStorage.removeItem('eliteFilesAdminPassword');
                
                // إعادة التحميل
                location.reload();
            }, 500);
        }
        
        // ============================================
        // نظام الملفات المظبوط مع تحميل مباشر
        // ============================================
        
        // تحميل الملفات من Firebase
        function loadFilesFromFirebase() {
            filesRef.on('value', (snapshot) => {
                const filesData = snapshot.val();
                displayFiles(filesData);
                
                // إذا كان مسؤولاً، تحديث قائمة الملفات في لوحة التحكم
                if (isAdmin) {
                    loadCurrentFilesForAdmin();
                }
            });
        }
        
        // عرض الملفات للمستخدمين
        function displayFiles(filesData) {
            const filesContainer = document.getElementById('filesContainer');
            const noFilesMessage = document.getElementById('noFilesMessage');
            
            if (!filesData || Object.keys(filesData).length === 0) {
                noFilesMessage.style.display = 'block';
                filesContainer.innerHTML = '';
                return;
            }
            
            noFilesMessage.style.display = 'none';
            filesContainer.innerHTML = '';
            
            Object.keys(filesData).forEach(fileId => {
                const file = filesData[fileId];
                // عرض الملف فقط إذا كان نشطاً
                if (file.isActive !== false) {
                    const fileCard = createFileCard(file, fileId);
                    filesContainer.appendChild(fileCard);
                }
            });
        }
        
        // إنشاء بطاقة ملف
        function createFileCard(file, fileId) {
            const fileCard = document.createElement('div');
            fileCard.className = 'file-card';
            
            const isFree = file.price === 0 || !file.isPaid;
            const isPurchased = userFiles[fileId] === true;
            
            fileCard.innerHTML = `
                <div class="file-header">
                    <i class="${getFileIcon(file.type)} file-icon"></i>
                    <h3 class="file-name">${file.name}</h3>
                    <div class="${isFree ? 'free-badge' : 'file-price'}">
                        ${isFree ? 'مجاني' : file.price + ' ج.م'}
                    </div>
                </div>
                <div class="file-body">
                    <p class="file-description">${file.description}</p>
                    <div class="file-details">
                        <div class="file-detail">
                            <i class="fas fa-file"></i>
                            <span>${getFileTypeName(file.type)}</span>
                        </div>
                        <div class="file-detail">
                            <i class="fas fa-weight-hanging"></i>
                            <span>${formatFileSize(file.size)}</span>
                        </div>
                        <div class="file-detail">
                            <i class="fas fa-download"></i>
                            <span>${file.downloads || 0}</span>
                        </div>
                    </div>
                    <div class="file-actions">
                        ${isFree ? 
                            `<button class="download-free-btn" onclick="downloadFile('${fileId}', true)">
                                <i class="fas fa-download"></i> تحميل مجاني
                            </button>` :
                            (isPurchased ?
                                `<button class="download-btn" onclick="downloadFile('${fileId}', false)">
                                    <i class="fas fa-download"></i> تحميل الملف
                                </button>` :
                                `<button class="buy-btn" onclick="buyFile('${fileId}')">
                                    <i class="fas fa-shopping-cart"></i> شراء الآن
                                </button>`
                            )
                        }
                    </div>
                </div>
            `;
            
            return fileCard;
        }
        
        // تحميل الملفات المشتراة للمستخدم
        function loadUserPurchasedFiles() {
            if (!currentUser || isAdmin) return;
            
            purchasedRef.child(currentUser).on('value', (snapshot) => {
                const purchasedData = snapshot.val();
                userFiles = purchasedData || {};
                
                // تحديث عرض الملفات
                loadFilesFromFirebase();
            });
        }
        
        // شراء ملف مدفوع
        function buyFile(fileId) {
            filesRef.child(fileId).once('value', (snapshot) => {
                const file = snapshot.val();
                if (!file) return;
                
                selectedFileForPurchase = { ...file, id: fileId };
                
                // إظهار قسم الدفع
                document.getElementById('filesSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('paymentSection').style.display = 'block';
                
                // تعيين بيانات الدفع
                document.getElementById('paymentAmount').textContent = file.price;
                document.getElementById('paymentFileName').textContent = file.name;
                
                // إعادة تعيين قسم الإثبات
                document.getElementById('uploadArea').classList.add('hidden');
                document.getElementById('previewContainer').classList.add('hidden');
                document.getElementById('proofFileName').textContent = '';
                if (proofFile) {
                    proofFile = null;
                    document.getElementById('paymentProof').value = '';
                }
                
                // تمرير للأعلى
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
        
        // تحميل ملف (سواء مجاني أو مدفوع)
        async function downloadFile(fileId, isFree = false) {
            if (!currentUser) {
                showNotification('يجب تسجيل الدخول أولاً', 'error');
                return;
            }
            
            // إذا كان ملف مدفوع وغير مشترى
            if (!isFree && !userFiles[fileId]) {
                showNotification('يجب شراء هذا الملف أولاً', 'error');
                return;
            }
            
            filesRef.child(fileId).once('value', async (snapshot) => {
                const file = snapshot.val();
                if (!file || !file.downloadUrl) {
                    showNotification('الملف غير متوفر للتحميل', 'error');
                    return;
                }
                
                showLoading(true);
                
                try {
                    // زيادة عداد التحميلات
                    const newDownloads = (file.downloads || 0) + 1;
                    await filesRef.child(fileId).update({ downloads: newDownloads });
                    
                    // تحميل الملف مباشرة
                    await forceDownloadFile(file.downloadUrl, file.originalName || file.name);
                    
                    showNotification('تم تحميل الملف بنجاح! ✅', 'success');
                } catch (error) {
                    console.error('خطأ التحميل:', error);
                    showNotification('حدث خطأ أثناء التحميل. حاول مرة أخرى.', 'error');
                } finally {
                    showLoading(false);
                }
            });
        }
        
        // تحميل الملف بشكل مباشر إلى مجلد التنزيلات
        async function forceDownloadFile(url, fileName) {
            return new Promise((resolve, reject) => {
                try {
                    // إنشاء رابط مؤقت للتحميل
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName || 'file';
                    
                    // إضافة سمات إضافية للتأكد من التحميل
                    link.setAttribute('target', '_blank');
                    link.setAttribute('rel', 'noopener noreferrer');
                    
                    // إضافة الرابط إلى الصفحة والنقر عليه
                    document.body.appendChild(link);
                    
                    // محاكاة النقر
                    if (link.click) {
                        link.click();
                    } else {
                        // للمتصفحات القديمة
                        const event = new MouseEvent('click', {
                            view: window,
                            bubbles: true,
                            cancelable: false
                        });
                        link.dispatchEvent(event);
                    }
                    
                    // إزالة الرابط من الصفحة
                    setTimeout(() => {
                        document.body.removeChild(link);
                        resolve(true);
                    }, 100);
                    
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        // ============================================
        // لوحة تحكم المسؤول المظبوطة
        // ============================================
        
        // تحميل الملفات الحالية للإدارة
        function loadCurrentFilesForAdmin() {
            if (!isAdmin) return;
            
            filesRef.once('value', (snapshot) => {
                const filesData = snapshot.val();
                displayFilesForAdmin(filesData);
            });
        }
        
        // عرض الملفات للإدارة
        function displayFilesForAdmin(filesData) {
            const currentFilesList = document.getElementById('currentFilesList');
            
            if (!filesData || Object.keys(filesData).length === 0) {
                currentFilesList.innerHTML = '<p style="color: #AAAAAA; text-align: center; padding: 30px; font-size: 1.1rem;">لا توجد ملفات</p>';
                return;
            }
            
            currentFilesList.innerHTML = '';
            
            Object.keys(filesData).forEach(fileId => {
                const file = filesData[fileId];
                const fileItem = createFileItemForAdmin(file, fileId);
                currentFilesList.appendChild(fileItem);
            });
        }
        
        // إنشاء عنصر ملف للإدارة
        function createFileItemForAdmin(file, fileId) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const isActive = file.isActive !== false;
            const isPaid = file.isPaid === true;
            const downloads = file.downloads || 0;
            
            fileItem.innerHTML = `
                <div class="file-item-info">
                    <div class="file-item-name">${file.name}</div>
                    <div class="file-item-details">
                        ${isPaid ? `💰 سعر: ${file.price} ج.م | ` : '🎁 مجاني | '}
                        📥 ${downloads} تحميل |
                        ${isActive ? '✅ نشط' : '❌ غير نشط'}
                    </div>
                </div>
                <div class="file-actions-admin">
                    <button class="edit-btn" onclick="editFile('${fileId}')">
                        <i class="fas fa-edit"></i> تعديل
                    </button>
                    <button class="toggle-btn" onclick="toggleFileStatus('${fileId}', ${isActive})">
                        <i class="fas fa-power-off"></i> ${isActive ? 'إيقاف' : 'تفعيل'}
                    </button>
                    <button class="delete-btn" onclick="deleteFile('${fileId}')">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                </div>
            `;
            
            return fileItem;
        }
        
        // تعديل ملف
        function editFile(fileId) {
            filesRef.child(fileId).once('value', (snapshot) => {
                const file = snapshot.val();
                if (!file) return;
                
                // تعبئة النموذج ببيانات الملف
                document.getElementById('fileName').value = file.name;
                document.getElementById('fileDescription').value = file.description;
                document.getElementById('filePrice').value = file.price || 0;
                document.getElementById('isPaid').checked = file.isPaid === true;
                
                // حفظ معرف الملف للتعديل
                editingFileId = fileId;
                
                // تغيير نص زر الإرسال
                const submitBtn = document.getElementById('submitFileBtn');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ التعديلات';
                submitBtn.style.background = 'linear-gradient(45deg, var(--blue), #2980b9)';
                
                // تمرير للأعلى
                document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
                
                showNotification('جارٍ تحميل بيانات الملف للتعديل...', 'info');
            });
        }
        
        // تبديل حالة الملف
        async function toggleFileStatus(fileId, currentStatus) {
            if (!isAdmin) return;
            
            try {
                const newStatus = !currentStatus;
                await filesRef.child(fileId).update({ 
                    isActive: newStatus,
                    updatedAt: Date.now()
                });
                
                showNotification(`تم ${newStatus ? 'تفعيل' : 'إيقاف'} الملف بنجاح`, 'success');
                loadCurrentFilesForAdmin();
                loadFilesFromFirebase();
            } catch (error) {
                showNotification('حدث خطأ أثناء التعديل', 'error');
            }
        }
        
        // حذف ملف
        async function deleteFile(fileId) {
            if (!isAdmin) return;
            
            if (confirm('⚠️ هل أنت متأكد من حذف هذا الملف؟ سيتم حذفه نهائياً من قاعدة البيانات.')) {
                showLoading(true);
                
                try {
                    await filesRef.child(fileId).remove();
                    
                    // حذف الطلبات المرتبطة بهذا الملف
                    const ordersSnapshot = await ordersRef.orderByChild('fileId').equalTo(fileId).once('value');
                    const ordersData = ordersSnapshot.val();
                    
                    if (ordersData) {
                        const deletePromises = Object.keys(ordersData).map(orderId => 
                            ordersRef.child(orderId).remove()
                        );
                        await Promise.all(deletePromises);
                    }
                    
                    showNotification('✅ تم حذف الملف والطلبات المرتبطة به بنجاح', 'success');
                    loadCurrentFilesForAdmin();
                    loadFilesFromFirebase();
                } catch (error) {
                    showNotification('حدث خطأ أثناء الحذف', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        // ============================================
        // نظام الطلبات والدفع المظبوط
        // ============================================
        
        // رفع إثبات الدفع
        document.getElementById('uploadProofBtn').addEventListener('click', function() {
            document.getElementById('uploadArea').classList.remove('hidden');
            document.getElementById('paymentProof').click();
        });
        
        // إرسال على واتساب
        document.getElementById('whatsappProofBtn').addEventListener('click', function() {
            if (!selectedFileForPurchase) return;
            
            const message = `طلب شراء ملف: ${selectedFileForPurchase.name}\n`
                          + `المبلغ: ${selectedFileForPurchase.price} ج.م\n`
                          + `اسم المستخدم: ${currentUser}\n`
                          + `التاريخ: ${new Date().toLocaleString('ar-EG')}`;
            
            const whatsappUrl = `https://wa.me/${VODAFONE_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // إنشاء طلب بدون صورة
            createOrder(null, 'whatsapp');
        });
        
        // اختيار صورة الإثبات
        document.getElementById('paymentProof').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // التحقق من الحجم
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('صورة كبيرة جداً! الحد الأقصى 5MB', 'error');
                    return;
                }
                
                // التحقق من نوع الملف
                const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/jpg'];
                if (!validTypes.includes(file.type)) {
                    showNotification('نوع الملف غير مدعوم. يسمح فقط بصور JPG, PNG, GIF', 'error');
                    return;
                }
                
                proofFile = file;
                document.getElementById('proofFileName').textContent = file.name;
                
                // عرض معاينة الصورة
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('previewContainer').classList.remove('hidden');
                    
                    // تمرير للقسم
                    document.getElementById('proofStep').scrollIntoView({ behavior: 'smooth' });
                };
                reader.readAsDataURL(file);
                
                showNotification('تم اختيار صورة الإثبات بنجاح', 'success');
            }
        });
        
        // إرسال طلب الدفع
        document.getElementById('submitPayment').addEventListener('click', function() {
            if (!proofFile) {
                showNotification('يرجى رفع إثبات الدفع أولاً', 'error');
                return;
            }
            
            createOrder(true, 'image');
        });
        
        // إنشاء طلب جديد
        async function createOrder(proofImage, proofType = 'image') {
            if (!selectedFileForPurchase || !currentUser) return;
            
            showLoading(true);
            
            try {
                let proofUrl = null;
                let proofFileName = null;
                
                // إذا كانت هناك صورة إثبات، رفعها
                if (proofImage && proofType === 'image') {
                    showNotification('جارٍ رفع إثبات الدفع...', 'info');
                    
                    const storageRef = storage.ref();
                    proofFileName = `proof_${Date.now()}_${proofFile.name}`;
                    const proofRef = storageRef.child(`proofs/${proofFileName}`);
                    const uploadTask = proofRef.put(proofFile);
                    
                    // عرض شريط التقدم
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'progress-container';
                    progressContainer.innerHTML = '<div class="progress-bar"></div>';
                    document.getElementById('proofStep').appendChild(progressContainer);
                    const progressBar = progressContainer.querySelector('.progress-bar');
                    
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            progressBar.style.width = progress + '%';
                        },
                        (error) => {
                            progressContainer.remove();
                            throw error;
                        },
                        async () => {
                            proofUrl = await uploadTask.snapshot.ref.getDownloadURL();
                            progressContainer.remove();
                        }
                    );
                    
                    // انتظار الانتهاء من الرفع
                    await new Promise((resolve, reject) => {
                        uploadTask.on('state_changed',
                            null,
                            reject,
                            resolve
                        );
                    });
                }
                
                // إنشاء بيانات الطلب
                const orderId = 'order_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const order = {
                    id: orderId,
                    fileId: selectedFileForPurchase.id,
                    fileName: selectedFileForPurchase.name,
                    filePrice: selectedFileForPurchase.price,
                    customerName: currentUser,
                    customerDeviceId: deviceId, // إضافة معرف الجهاز للطلب
                    status: 'pending',
                    proofType: proofType,
                    proofUrl: proofUrl,
                    proofFileName: proofFileName,
                    createdAt: Date.now(),
                    confirmedAt: null
                };
                
                // حفظ الطلب في قاعدة البيانات
                await ordersRef.child(orderId).set(order);
                
                showNotification('✅ تم إرسال طلبك للمسؤول بنجاح!', 'success');
                goBackToFiles();
                
            } catch (error) {
                showNotification('حدث خطأ أثناء إنشاء الطلب: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // ============================================
        // إدارة الطلبات للمسؤول
        // ============================================
        
        // تحميل الطلبات من Firebase
        function loadOrdersFromFirebase() {
            if (!isAdmin) return;
            
            ordersRef.on('value', (snapshot) => {
                const ordersData = snapshot.val();
                displayOrders(ordersData);
            });
        }
        
        // عرض الطلبات
        function displayOrders(ordersData) {
            const ordersContainer = document.getElementById('ordersContainer');
            
            if (!ordersData || Object.keys(ordersData).length === 0) {
                ordersContainer.innerHTML = '<p style="text-align: center; color: #AAAAAA; grid-column: 1 / -1; padding: 30px; font-size: 1.1rem;">لا توجد طلبات حتى الآن</p>';
                return;
            }
            
            ordersContainer.innerHTML = '';
            
            // تحويل إلى مصفوفة وترتيب
            const ordersArray = Object.keys(ordersData).map(key => ({
                id: key,
                ...ordersData[key]
            }));
            
            // ترتيب: المعلقة أولاً
            ordersArray.sort((a, b) => {
                if (a.status === 'pending' && b.status !== 'pending') return -1;
                if (a.status !== 'pending' && b.status === 'pending') return 1;
                return b.createdAt - a.createdAt;
            });
            
            // عرض كل طلب
            ordersArray.forEach(order => {
                const orderCard = createOrderCard(order);
                ordersContainer.appendChild(orderCard);
            });
        }
        
        // إنشاء بطاقة طلب
        function createOrderCard(order) {
            const orderCard = document.createElement('div');
            orderCard.className = 'order-card';
            
            let proofContent = '';
            if (order.proofType === 'image' && order.proofUrl) {
                proofContent = `
                    <img src="${order.proofUrl}" alt="إثبات الدفع" 
                         onclick="viewProof('${order.id}')"
                         onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/333/fff?text=صورة+غير+متاحة';">
                    <div class="proof-actions">
                        <button class="delete-proof-btn" onclick="deleteProof('${order.id}')">
                            <i class="fas fa-trash"></i> حذف الإثبات
                        </button>
                    </div>
                `;
            } else if (order.proofType === 'whatsapp') {
                proofContent = '<p style="color: var(--green); font-weight: 700; padding: 10px; background: rgba(37, 211, 102, 0.1); border-radius: 8px; border: 1px solid rgba(37, 211, 102, 0.2);">'
                             + '<i class="fab fa-whatsapp"></i> تم الإرسال عبر واتساب'
                             + '</p>';
            }
            
            const actionButtons = order.status === 'pending' ? 
                `<button class="confirm-btn" onclick="confirmOrder('${order.id}', '${order.customerName}', '${order.fileId}')">
                    <i class="fas fa-check-circle"></i> تأكيد الدفع
                </button>
                <button class="reject-btn" onclick="rejectOrder('${order.id}')">
                    <i class="fas fa-times-circle"></i> رفض الطلب
                </button>` :
                `<button class="confirm-btn" onclick="sendDownloadNotification('${order.customerName}', '${order.fileId}', '${order.fileName}')">
                    <i class="fas fa-share"></i> تم التأكيد
                </button>`;
            
            orderCard.innerHTML = `
                <div class="order-header">
                    <div class="order-file">${order.fileName}</div>
                    <div class="order-status ${order.status === 'pending' ? 'status-pending' : 'status-completed'}">
                        ${order.status === 'pending' ? '⏳ بانتظار التأكيد' : '✅ مكتمل'}
                    </div>
                </div>
                <div class="order-details">
                    <div class="order-detail">
                        <span>👤 اسم العميل:</span>
                        <span>${order.customerName}</span>
                    </div>
                    <div class="order-detail">
                        <span>📅 التاريخ:</span>
                        <span>${new Date(order.createdAt).toLocaleString('ar-EG')}</span>
                    </div>
                    <div class="order-detail">
                        <span>💰 المبلغ:</span>
                        <span>${order.filePrice} ج.م</span>
                    </div>
                    <div class="order-detail">
                        <span>📱 معرف الجهاز:</span>
                        <span style="font-family: monospace; font-size: 0.8rem;">${order.customerDeviceId ? order.customerDeviceId.substring(0, 12) + '...' : 'غير معروف'}</span>
                    </div>
                </div>
                <div class="order-proof">
                    <p style="font-weight: 700; color: var(--gold); margin-bottom: 10px;">
                        <i class="fas fa-receipt"></i> إثبات الدفع:
                    </p>
                    ${proofContent}
                </div>
                ${actionButtons}
            `;
            
            return orderCard;
        }
        
        // تأكيد الطلب
        async function confirmOrder(orderId, customerName, fileId) {
            if (!isAdmin) return;
            
            showLoading(true);
            
            try {
                // الحصول على بيانات الطلب والملف
                const orderSnapshot = await ordersRef.child(orderId).once('value');
                const order = orderSnapshot.val();
                
                if (!order) throw new Error('الطلب غير موجود');
                
                const fileSnapshot = await filesRef.child(fileId).once('value');
                const file = fileSnapshot.val();
                
                if (!file) throw new Error('الملف غير موجود');
                
                // تحديث حالة الطلب
                await ordersRef.child(orderId).update({
                    status: 'completed',
                    confirmedAt: Date.now(),
                    confirmedBy: currentUser
                });
                
                // إضافة الملف للمستخدم كمشترى
                await purchasedRef.child(customerName).child(fileId).set(true);
                
                // زيادة عداد التحميلات للملف
                const newDownloads = (file.downloads || 0) + 1;
                await filesRef.child(fileId).update({ downloads: newDownloads });
                
                showNotification('✅ تم تأكيد الطلب بنجاح! يمكن للعميل الآن تحميل الملف.', 'success');
                
                // إعادة تحميل البيانات
                loadOrdersFromFirebase();
                
            } catch (error) {
                showNotification('حدث خطأ أثناء تأكيد الطلب: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // رفض الطلب
        async function rejectOrder(orderId) {
            if (!isAdmin) return;
            
            if (confirm('⚠️ هل أنت متأكد من رفض هذا الطلب؟ سيتم حذف الطلب.')) {
                showLoading(true);
                
                try {
                    await ordersRef.child(orderId).remove();
                    showNotification('✅ تم رفض الطلب بنجاح', 'success');
                } catch (error) {
                    showNotification('حدث خطأ أثناء رفض الطلب', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        // حذف الإثبات
        async function deleteProof(orderId) {
            if (!isAdmin) return;
            
            if (confirm('⚠️ هل تريد حذف صورة الإثبات؟')) {
                showLoading(true);
                
                try {
                    const orderSnapshot = await ordersRef.child(orderId).once('value');
                    const order = orderSnapshot.val();
                    
                    if (order && order.proofFileName) {
                        // حذف الصورة من التخزين
                        const storageRef = storage.ref();
                        const proofRef = storageRef.child(`proofs/${order.proofFileName}`);
                        await proofRef.delete();
                        
                        // تحديث الطلب
                        await ordersRef.child(orderId).update({
                            proofUrl: null,
                            proofFileName: null
                        });
                        
                        showNotification('✅ تم حذف صورة الإثبات بنجاح', 'success');
                    }
                } catch (error) {
                    showNotification('حدث خطأ أثناء حذف الإثبات', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }
        
        // عرض صورة الإثبات
        function viewProof(orderId) {
            ordersRef.child(orderId).once('value', (snapshot) => {
                const order = snapshot.val();
                if (order && order.proofUrl) {
                    window.open(order.proofUrl, '_blank', 'width=800,height=600');
                }
            });
        }
        
        // إرسال إشعار التحميل
        async function sendDownloadNotification(customerName, fileId, fileName) {
            showNotification(`تم تأكيد طلب ${customerName} لتحميل ${fileName}`, 'success');
        }
        
        // ============================================
        // نظام إدارة الملفات للمسؤول
        // ============================================
        
        // رفع ملف جديد
        document.getElementById('fileUploadArea').addEventListener('click', function() {
            document.getElementById('fileUpload').click();
        });
        
        document.getElementById('fileUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // التحقق من الحجم
                if (file.size > 50 * 1024 * 1024) {
                    showNotification('الملف كبير جداً! الحد الأقصى 50MB', 'error');
                    return;
                }
                
                uploadedFile = file;
                document.getElementById('fileNameDisplay').textContent = file.name;
                showNotification('تم اختيار الملف: ' + file.name, 'success');
            }
        });
        
        // إضافة أو تعديل ملف
        document.getElementById('fileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showNotification('ليست لديك صلاحية إدارة الملفات', 'error');
                return;
            }
            
            const fileName = document.getElementById('fileName').value;
            const fileDescription = document.getElementById('fileDescription').value;
            const filePrice = parseInt(document.getElementById('filePrice').value) || 0;
            const isPaid = document.getElementById('isPaid').checked;
            
            // التحقق من البيانات
            if (!fileName || !fileDescription) {
                showNotification('يرجى ملء جميع الحقول', 'error');
                return;
            }
            
            // إذا كان مدفوعاً والسعر صفر
            if (isPaid && filePrice <= 0) {
                showNotification('الملف مدفوع يجب أن يكون له سعر أكبر من صفر', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                if (editingFileId) {
                    // تعديل ملف موجود
                    await updateExistingFile(fileName, fileDescription, filePrice, isPaid);
                } else {
                    // إضافة ملف جديد
                    if (!uploadedFile) {
                        showNotification('يجب رفع ملف حقيقي أولاً', 'error');
                        showLoading(false);
                        return;
                    }
                    await addNewFile(fileName, fileDescription, filePrice, isPaid);
                }
            } catch (error) {
                showNotification('حدث خطأ: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        });
        
        // إضافة ملف جديد
        async function addNewFile(fileName, fileDescription, filePrice, isPaid) {
            try {
                showNotification('جارٍ رفع الملف...', 'info');
                
                const storageRef = storage.ref();
                const fileNameSafe = fileName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                const fileRef = storageRef.child(`files/${Date.now()}_${fileNameSafe}_${uploadedFile.name}`);
                const uploadTask = fileRef.put(uploadedFile);
                
                // عرض شريط التقدم
                const progressContainer = document.getElementById('uploadProgress');
                const progressBar = document.getElementById('progressBar');
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressBar.style.width = progress + '%';
                    },
                    (error) => {
                        progressContainer.style.display = 'none';
                        throw error;
                    },
                    async () => {
                        // الحصول على رابط التحميل
                        const downloadUrl = await uploadTask.snapshot.ref.getDownloadURL();
                        
                        // إنشاء بيانات الملف
                        const fileType = getFileExtension(uploadedFile.name);
                        const newFile = {
                            name: fileName,
                            description: fileDescription,
                            price: isPaid ? filePrice : 0,
                            isPaid: isPaid,
                            type: fileType,
                            size: uploadedFile.size,
                            downloadUrl: downloadUrl,
                            originalName: uploadedFile.name,
                            downloads: 0,
                            isActive: true,
                            createdAt: Date.now(),
                            createdBy: currentUser
                        };
                        
                        // حفظ في قاعدة البيانات
                        const newFileRef = filesRef.push();
                        await newFileRef.set(newFile);
                        
                        // إعادة تعيين النموذج
                        resetFileForm();
                        progressContainer.style.display = 'none';
                        
                        showNotification('✅ تم إضافة الملف بنجاح!', 'success');
                        
                        // تحديث العرض
                        loadCurrentFilesForAdmin();
                        loadFilesFromFirebase();
                    }
                );
                
            } catch (error) {
                throw error;
            }
        }
        
        // تحديث ملف موجود
        async function updateExistingFile(fileName, fileDescription, filePrice, isPaid) {
            try {
                const updates = {
                    name: fileName,
                    description: fileDescription,
                    price: isPaid ? filePrice : 0,
                    isPaid: isPaid,
                    updatedAt: Date.now(),
                    updatedBy: currentUser
                };
                
                await filesRef.child(editingFileId).update(updates);
                
                // إعادة تعيين النموذج
                resetFileForm();
                
                showNotification('✅ تم تحديث الملف بنجاح!', 'success');
                
                // تحديث العرض
                loadCurrentFilesForAdmin();
                loadFilesFromFirebase();
                
            } catch (error) {
                throw error;
            }
        }
        
        // إعادة تعيين نموذج الملف
        function resetFileForm() {
            document.getElementById('fileForm').reset();
            document.getElementById('fileNameDisplay').textContent = '';
            uploadedFile = null;
            editingFileId = null;
            
            // إعادة زر الإرسال للنص الأصلي
            const submitBtn = document.getElementById('submitFileBtn');
            submitBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> رفع الملف';
            submitBtn.style.background = 'linear-gradient(45deg, var(--green), #2ECC71)';
            
            // إعادة تعيين checkbox
            document.getElementById('isPaid').checked = false;
        }
        
        // ============================================
        // أدوات مساعدة
        // ============================================
        
        // الحصول على أيقونة الملف
        function getFileIcon(type) {
            const icons = {
                'pdf': 'fas fa-file-pdf',
                'doc': 'fas fa-file-word',
                'docx': 'fas fa-file-word',
                'txt': 'fas fa-file-alt',
                'zip': 'fas fa-file-archive',
                'rar': 'fas fa-file-archive',
                '7z': 'fas fa-file-archive',
                'mp4': 'fas fa-file-video',
                'avi': 'fas fa-file-video',
                'mkv': 'fas fa-file-video',
                'mp3': 'fas fa-file-audio',
                'wav': 'fas fa-file-audio',
                'jpg': 'fas fa-file-image',
                'jpeg': 'fas fa-file-image',
                'png': 'fas fa-file-image',
                'gif': 'fas fa-file-image',
                'exe': 'fas fa-cogs',
                'msi': 'fas fa-cogs',
                'apk': 'fas fa-mobile-alt'
            };
            return icons[type] || 'fas fa-file';
        }
        
        // الحصول على امتداد الملف
        function getFileExtension(filename) {
            return filename.split('.').pop().toLowerCase();
        }
        
        // الحصول على اسم نوع الملف
        function getFileTypeName(type) {
            const names = {
                'pdf': 'PDF',
                'doc': 'Word',
                'docx': 'Word',
                'txt': 'نصي',
                'zip': 'ZIP',
                'rar': 'RAR',
                '7z': '7ZIP',
                'mp4': 'فيديو',
                'avi': 'فيديو',
                'mkv': 'فيديو',
                'mp3': 'صوت',
                'wav': 'صوت',
                'jpg': 'صورة',
                'jpeg': 'صورة',
                'png': 'صورة',
                'gif': 'صورة',
                'exe': 'برنامج',
                'msi': 'برنامج',
                'apk': 'تطبيق'
            };
            return names[type] || 'ملف';
        }
        
        // تنسيق حجم الملف
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' بايت';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' ك.بايت';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' م.بايت';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' ج.بايت';
        }
        
        // العودة للملفات
        function goBackToFiles() {
            if (isAdmin) {
                document.getElementById('filesSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('paymentSection').style.display = 'none';
            } else {
                document.getElementById('filesSection').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('paymentSection').style.display = 'none';
                
                // تحميل الملفات المشتراة
                loadUserPurchasedFiles();
            }
            
            // إعادة تعيين البيانات
            selectedFileForPurchase = null;
            proofFile = null;
            document.getElementById('previewContainer').classList.add('hidden');
            document.getElementById('uploadArea').classList.add('hidden');
            if (document.getElementById('paymentProof')) {
                document.getElementById('paymentProof').value = '';
            }
            
            // تمرير للأعلى
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // ============================================
        // إعداد معالجات الأحداث
        // ============================================
        
        function setupEventListeners() {
            // العودة للملفات بالضغط على اللوجو
            document.querySelector('.logo').addEventListener('click', goBackToFiles);
            
            // السماح بالدخول بالزر Enter
            document.getElementById('usernameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginBtn').click();
                }
            });
            
            // كلمة مرور المسؤول بالزر Enter
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginAdminBtn').click();
                }
            });
            
            // تحديث حالة checkbox مع تغيير السعر
            document.getElementById('filePrice').addEventListener('input', function() {
                const price = parseInt(this.value) || 0;
                const isPaidCheckbox = document.getElementById('isPaid');
                
                if (price > 0) {
                    isPaidCheckbox.checked = true;
                }
            });
            
            // تحديث السعر مع تغيير checkbox
            document.getElementById('isPaid').addEventListener('change', function() {
                const priceInput = document.getElementById('filePrice');
                if (!this.checked) {
                    priceInput.value = 0;
                }
            });
        }
        
        // ============================================
        // نظام العرض والتشغيل
        // ============================================
        
        // عرض الإشعارات
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // عرض/إخفاء التحميل
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }
        
        // عند تحميل الصفحة، تحقق من الجلسة
        if (currentUser) {
            loadUserPurchasedFiles();
        }
        
        // تهيئة معرف الجهاز
        deviceId = generateDeviceId();
    </script>
</body>
</html>